---
import Layout from "../layouts/Layout.astro";
import Hero from "../components/Hero.tsx";
import FeatureRow from "../components/FeatureRow.tsx";
import AccessoryBlocks from "../components/AccessoryBlocks.tsx";
import Promo from "../components/Promo.tsx";
import Reviews from "../components/Reviews.tsx";
import categories from "../data/categories.json";
import products from "../data/products.json";
import hero from "../data/hero.json";
import promo from "../data/promo.json";
import reviews from "../data/reviews.json";
import exclusiveOffer from "../data/exclusive-offer.json";



const productsProp = products
  .map((p) => {
    return {
      ...p,
      imageSrc: p.images.sort((a, b) => 0.5 - Math.random())[0].url,
    };
  })
  .sort((a, b) => 0.5 - Math.random())
  .slice(0, 4);

---
<Layout title="Astro Shop">
  <Hero
    cta={hero.cta}
    heading={hero.heading}
    description={hero.description}
    heroImage={hero.heroImage}
  />
  <main>
    <FeatureRow categories={categories} />
    <Promo
      backgroundImage={promo.image.src}
      heading={promo.heading}
      description={promo.description}
      button={promo.cta}
    />
    <AccessoryBlocks products={productsProp} />
    {/* load on visible to support modal */}
    <Reviews testimonials={reviews} offer={exclusiveOffer} client:idle client:visible/>
  </main>
</Layout>
